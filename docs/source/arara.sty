% -------------------------------------------------
% Arara -- the cool TeX automation tool
% Copyright (c) 2012, Paulo Roberto Massa Cereda
% All rights reserved.
%
% Redistribution and  use in source  and binary forms, with  or without
% modification, are  permitted provided  that the  following conditions
% are met:
%
% 1. Redistributions  of source  code must  retain the  above copyright
% notice, this list of conditions and the following disclaimer.
%
% 2. Redistributions in binary form  must reproduce the above copyright
% notice, this list  of conditions and the following  disclaimer in the
% documentation and/or other materials provided with the distribution.
%
% 3. Neither  the name  of the  project's author nor  the names  of its
% contributors may be used to  endorse or promote products derived from
% this software without specific prior written permission.
%
% THIS SOFTWARE IS  PROVIDED BY THE COPYRIGHT  HOLDERS AND CONTRIBUTORS
% "AS IS"  AND ANY  EXPRESS OR IMPLIED  WARRANTIES, INCLUDING,  BUT NOT
% LIMITED  TO, THE  IMPLIED WARRANTIES  OF MERCHANTABILITY  AND FITNESS
% FOR  A PARTICULAR  PURPOSE  ARE  DISCLAIMED. IN  NO  EVENT SHALL  THE
% COPYRIGHT HOLDER OR CONTRIBUTORS BE  LIABLE FOR ANY DIRECT, INDIRECT,
% INCIDENTAL, SPECIAL, EXEMPLARY,  OR CONSEQUENTIAL DAMAGES (INCLUDING,
% BUT  NOT LIMITED  TO, PROCUREMENT  OF SUBSTITUTE  GOODS OR  SERVICES;
% LOSS  OF USE,  DATA, OR  PROFITS; OR  BUSINESS INTERRUPTION)  HOWEVER
% CAUSED AND  ON ANY THEORY  OF LIABILITY, WHETHER IN  CONTRACT, STRICT
% LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY
% WAY  OUT  OF  THE USE  OF  THIS  SOFTWARE,  EVEN  IF ADVISED  OF  THE
% POSSIBILITY OF SUCH DAMAGE.
% -------------------------------------------------

% package definition
% -------------------------------------------------
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{arara}[2012/04/02 Arara User Manual Configuration]
% -------------------------------------------------

% required packages
% -------------------------------------------------
\RequirePackage{graphicx}
\RequirePackage{xcolor}
\RequirePackage{listings}
\RequirePackage[framemethod=TikZ]{mdframed}
\usetikzlibrary{calc}
\RequirePackage{cantarell}
\RequirePackage{lmodern}
\RequirePackage[scaled=0.8]{beramono}
\RequirePackage{marvosym}
\RequirePackage{enumitem}
\RequirePackage{xspace}

% colors
% -------------------------------------------------
\definecolor{araracolor}{RGB}{0,128,128}
\definecolor{bluekeywords}{rgb}{0.13,0.13,1}
\definecolor{greencomments}{rgb}{0,0.5,0}
\definecolor{redstrings}{rgb}{0.9,0,0}
% -------------------------------------------------

% chapter style
% -------------------------------------------------
\makechapterstyle{ararastyle}{%
  \chapterstyle{default}
\renewcommand*{\chapnamefont}{\color{araracolor}\fontfamily{fco}\bfseries\LARGE}
\renewcommand*{\chaptitlefont}{\color{araracolor}\hfill\fontfamily{fco}\bfseries\Huge}
\renewcommand*{\printchapternum}{\color{araracolor}\chapnamefont\fontfamily{fco}\thechapter}
\renewcommand*{\printchaptertitle}[1]{%
\begin{mdframed}[innertopmargin=10pt,innerbottommargin=10pt,innerleftmargin=10pt,innerrightmargin=10pt,roundcorner=5pt,linecolor=araracolor,middlelinewidth=2pt]%
\color{araracolor}\fontfamily{fco}\bfseries\LARGE\MoveDown\hfill ##1%
\end{mdframed}}}
% -------------------------------------------------

% part style
% -------------------------------------------------
\renewcommand*{\parttitlefont}{\color{araracolor}\fontfamily{fco}\bfseries\Huge}
\renewcommand*{\partnamefont}{\color{araracolor}\fontfamily{fco}\bfseries\Huge}
\renewcommand*{\partnumfont}{\color{araracolor}\fontfamily{fco}\bfseries\Huge}
\renewcommand*{\printparttitle}[1]{%
\begin{mdframed}[innertopmargin=10pt,innerbottommargin=10pt,innerleftmargin=10pt,innerrightmargin=10pt,roundcorner=5pt,linecolor=araracolor,middlelinewidth=2pt]%
\parttitlefont{\Forward\hfill#1}
\end{mdframed}}
% -------------------------------------------------

% section style
% -------------------------------------------------
\setsecheadstyle{\color{araracolor}\fontfamily{fco}\bfseries\Large\raggedright}
\setsubsecheadstyle{\color{araracolor}\fontfamily{fco}\bfseries\large\raggedright}
\setsubsubsecheadstyle{\color{araracolor}\fontfamily{fco}\bfseries\normalsize\raggedright}
% -------------------------------------------------

% infobox environment
% -------------------------------------------------
\newmdenv[innertopmargin=10pt, innerbottommargin=10pt, innerleftmargin=10pt, innerrightmargin=10pt, roundcorner=5pt, linecolor=araracolor, middlelinewidth=2pt, frametitleaboveskip=10pt, frametitlebelowskip=10pt, frametitlefont=\color{araracolor}\fontfamily{fco}\bfseries]{infobox}
% -------------------------------------------------

% heading style
% -------------------------------------------------
\makepagestyle{araraheadings}
\makeevenhead{araraheadings}{\thepage}{}{\slshape\leftmark}
\makeoddhead{araraheadings}{\slshape\rightmark}{}{\thepage}
\makepsmarks{araraheadings}{%
\def\chaptermark##1{%
\markboth{%
\ifnum\c@secnumdepth > \m@ne
\if@mainmatter
\@chapapp\ \thechapter. \ %
\fi
\fi
##1}{}}%
\def\sectionmark##1{%
\markright{%
\ifnum\c@secnumdepth > \z@
\thesection. \ %
\fi
##1}}
\def\tocmark{\markboth{\contentsname}{}}
\def\lofmark{\markboth{\listfigurename}{}}
\def\lotmark{\markboth{\listtablename}{}}
\def\bibmark{\markboth{\bibname}{}}
\def\indexmark{\markboth{\indexname}{}}
\def\glossarymark{\markboth{\glossaryname}{}}}
% -------------------------------------------------

% language environments

% YAML
% -------------------------------------------------
\lstnewenvironment{yaml}{\lstset{%
   basicstyle=\ttfamily,
   numbers=left,
   xleftmargin=1.5em,
   breaklines=true,
   numberstyle=\color{araracolor}\ttfamily\small,
   columns=flexible,
   mathescape=false,
   %escapechar=|,
   literate={<B>}{\color{bluekeywords}}{-1}
			{<R>}{\color{redstrings}}{-1}
            {<G>}{\color{greencomments}}{-1}
	        {<A>}{\normalcolor}{-1}
}}{}
% -------------------------------------------------

% Java
% -------------------------------------------------
\lstnewenvironment{java}{\lstset{%
   language=Java,
   basicstyle=\ttfamily,
   columns=flexible,
   showspaces=false,
   numbers=left,
   xleftmargin=1.5em,
   breaklines=true,
   numberstyle=\color{araracolor}\ttfamily\small,
   breakatwhitespace=true,
   showstringspaces=false,
   commentstyle=\color{greencomments},
   keywordstyle=\color{bluekeywords},
   stringstyle=\color{redstrings}
}}{}
% -------------------------------------------------

% LaTeX
% -------------------------------------------------
\lstnewenvironment{latex}{\lstset{%
   language=[LaTeX]TeX,
   basicstyle=\ttfamily,
   columns=flexible,
   showspaces=false,
   numbers=left,
   xleftmargin=1.5em,
   breaklines=true,
   numberstyle=\color{araracolor}\ttfamily\small,
   breakatwhitespace=true,
   showstringspaces=false,
   commentstyle=\color{greencomments},
   keywordstyle=\color{bluekeywords},
   stringstyle=\color{redstrings}
}}{}

% bash
% -------------------------------------------------
\lstnewenvironment{bash}{\lstset{%
   language=bash,
   basicstyle=\ttfamily,
   columns=flexible,
   showspaces=false,
   xleftmargin=1.5em,
   breaklines=true,
   numberstyle=\color{araracolor}\ttfamily\small,
   breakatwhitespace=true,
   showstringspaces=false,
   commentstyle=\color{greencomments},
   keywordstyle=\color{bluekeywords},
   stringstyle=\color{redstrings},
   keywords={latexmk,rubber,pdfcrop,pdflatex,bibtex,makeindex,
            chmod,java,arara,export,PATH,@echo,off},%
}}{}
% -------------------------------------------------

% Short inline listings
%\lstMakeShortInline[]{}
\lstMakeShortInline[language=bash,%
                    basicstyle=\ttfamily,%
                    commentstyle=\color{greencomments},%
                    keywordstyle=\color{bluekeywords},
                    keywords={latexmk,rubber,pdfcrop,pdflatex,bibtex,makeindex,
                              chmod,java,arara,export,PATH,},%
                    alsoletter={.},
                    stringstyle=\color{redstrings}]{|}

% list of codes
% -------------------------------------------------
\newcommand{\codename}{Code}
\newcommand{\listcodename}{List of Codes}
\newlistof{listofcodes}{cod}{\listcodename}
\newfloat{code}{cod}{\codename}
\newlistentry{code}{cod}{0}
% -------------------------------------------------

% caption style
% -------------------------------------------------
\captionnamefont{\fontfamily{fco}\color{araracolor}\bfseries}
\captiondelim{ $\bullet$ }
% -------------------------------------------------

% description style
% -------------------------------------------------
\setlist[description]{font=\sffamily\bfseries,style=nextline,leftmargin=2em}
% -------------------------------------------------

% hyperref here, so it won't cause any trouble
% -------------------------------------------------
\RequirePackage[colorlinks, linkcolor={black}, urlcolor={araracolor},pdfpagelabels]{hyperref}

% -------------------------------------------------

% Helper macros
% -------------------------------------------------
\newcommand*\arara{{\fontfamily{fco}\color{araracolor}\bfseries arara}\xspace}
\newcommand*\arararule{{\fontfamily{fco}\color{araracolor}\bfseries arara rule}\xspace}
\newcommand{\feature}[1]{%
\begin{tikzpicture}%
\node[draw=black!30,top color=white,bottom color=black!20,inner sep=1pt, minimum height=0.32cm, minimum width=0.8cm,rounded corners=3pt,font=\sffamily\tiny] {#1};
\end{tikzpicture}%
}

\newcommand{\featurenew}{\feature{\raisebox{-.5pt}[\height][0pt]{new}}}
\newcommand{\featurefixed}{\feature{\raisebox{0pt}[\height][0pt]{fixed}}}
% -------------------------------------------------



% Environment and command for yaml rules

% yamlrule
% -------------------------------------------------
\tikzset{%
   warningsymbol/.style={%
            rectangle,draw=araracolor,rounded corners=3pt,
            fill=white,scale=1,,rotate=90,
            overlay}}
\newmdenv[%
    hidealllines=true,leftline=true,nobreak=true,%
    skipabove=12,skipbelow=12pt,
    innertopmargin=0.4em,%
    innerbottommargin=0.4em,%
    innerrightmargin=0.7em,%
    innermargin=1em,%
    outermargin=1em,%
    innerleftmargin=1.7em,%
    leftmargin=0.7em,%
    middlelinewidth=.2em,%
    linecolor=araracolor,%
    firstextra={\path let \p1=(P), \p2=(O) in ($(\x2,0)+0.5*(0,\y1)$)%
                node[warningsymbol] {\arararule};},%
    secondextra={\path let \p1=(P), \p2=(O) in ($(\x2,0)+0.5*(0,\y1)$)%
                  node[warningsymbol] {\arararule};},%
    middleextra={\path let \p1=(P), \p2=(O) in ($(\x2,0)+0.5*(0,\y1)$)%
                 node[warningsymbol] {\arararule};},%
    singleextra={\path let \p1=(P), \p2=(O) in ($(\x2,0)+0.5*(0,\y1)$)%
                 node[warningsymbol] {\arararule};},%
]{yamlrule}

\newcommand*\headyamlrule[1]{%
  \phantomsection%
  \subsection*{#1}%
  \addcontentsline{toc}{section}{\texttt{#1}}%
%  \subsection*{Predefined rule: {\color{bluekeywords}\ttfamily #1}}%
  }
\newcommand*\optionyamlrule{\subsubsection*{Options}}

% -------------------------------------------------
